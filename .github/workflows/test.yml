name: Test

on: pull_request

jobs:

  jest: 
    name: Jest
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Setup Node.js 14.x
        uses: actions/setup-node@v3
        with:
          node-version: '14'
          cache: 'yarn'

      - name: Install Dependencies
        run: yarn install

      - uses: amancevice/setup-code-climate@main
        with:
          cc_test_reporter_id: ${{ secrets.CC_TEST_REPORTER_ID }}
      
      - name: Setup Code Climate
        run: cc-test-reporter before-build

      - name: Run tests
        run: yarn test:ci
        timeout-minutes: 10

      - name: Send results to Code Climate
        run: cc-test-reporter after-build

      - name: Code Coverage Report
        uses: romeovs/lcov-reporter-action@v0.2.16
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
